{% extends 'base.html' %}

{% block title %}Importa√ß√£o de Tabela - TabloideAMP{% endblock %}

{% block extra_css %}
<style>
  .import-page {
    max-width: 800px;
    margin: 0 auto;
    padding: var(--space-xl) 0;
  }

  .page-header {
    text-align: center;
    margin-bottom: var(--space-2xl);
    padding-bottom: var(--space-lg);
    border-bottom: 1px solid var(--border);
  }

  .page-title {
    font-size: 2rem;
    font-weight: 700;
    color: var(--text);
    margin-bottom: var(--space-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-md);
  }

  .page-icon {
    font-size: 2.5rem;
  }

  .page-subtitle {
    color: var(--text-secondary);
    margin: 0;
    font-size: 1.1rem;
  }

  .import-container {
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    padding: var(--space-2xl);
    margin-bottom: var(--space-xl);
    box-shadow: var(--shadow-sm);
  }

  .import-section {
    margin-bottom: var(--space-xl);
  }

  .section-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text);
    margin-bottom: var(--space-lg);
    padding-bottom: var(--space-sm);
    border-bottom: 1px solid var(--border-light);
    display: flex;
    align-items: center;
    gap: var(--space-sm);
  }

  .section-icon {
    font-size: 1.5rem;
  }

  .form-group {
    margin-bottom: var(--space-lg);
  }

  .form-group label {
    display: block;
    margin-bottom: var(--space-sm);
    font-weight: 500;
    color: var(--text);
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .file-input-wrapper {
    position: relative;
    display: block;
    width: 100%;
  }

  .file-input-wrapper input[type="file"] {
    opacity: 0;
    position: absolute;
    z-index: -1;
  }

  .file-input-label {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: var(--space-2xl);
    border: 3px dashed var(--border);
    border-radius: var(--radius-lg);
    background: var(--background-subtle);
    cursor: pointer;
    transition: var(--transition);
    text-align: center;
    color: var(--text-secondary);
    flex-direction: column;
    gap: var(--space-md);
    min-height: 200px;
  }

  .file-input-label:hover {
    border-color: var(--primary);
    background: rgba(var(--primary-rgb), 0.05);
    color: var(--primary);
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
  }

  .file-icon {
    font-size: 4rem;
    margin-bottom: var(--space-md);
  }

  .file-text {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: var(--space-sm);
  }

  .file-hint {
    font-size: 0.875rem;
    opacity: 0.8;
  }

  .supported-formats {
    display: flex;
    justify-content: center;
    gap: var(--space-md);
    margin-top: var(--space-md);
  }

  .format-badge {
    background: var(--primary);
    color: white;
    padding: var(--space-xs) var(--space-sm);
    border-radius: var(--radius-full);
    font-size: 0.75rem;
    font-weight: 500;
    text-transform: uppercase;
  }

  .instructions {
    background: rgba(59, 130, 246, 0.1);
    border: 1px solid rgba(59, 130, 246, 0.3);
    border-radius: var(--radius-lg);
    padding: var(--space-lg);
    margin-bottom: var(--space-xl);
  }

  .instructions-title {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    font-weight: 600;
    color: #3b82f6;
    margin-bottom: var(--space-md);
  }

  .instructions-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .instructions-list li {
    display: flex;
    align-items: flex-start;
    gap: var(--space-sm);
    margin-bottom: var(--space-sm);
    color: var(--text-secondary);
  }

  .step-number {
    background: #3b82f6;
    color: white;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
    font-weight: 600;
    flex-shrink: 0;
  }

  .form-actions {
    display: flex;
    gap: var(--space-md);
    justify-content: center;
    margin-top: var(--space-2xl);
    padding-top: var(--space-lg);
    border-top: 1px solid var(--border);
  }

  .btn-import {
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
    border: none;
    padding: var(--space-md) var(--space-xl);
    border-radius: var(--radius-md);
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    transition: var(--transition);
    min-width: 160px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-sm);
  }

  .btn-import:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
  }

  .btn-import:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
  }

  .btn-cancel {
    background: transparent;
    color: var(--text-secondary);
    border: 1px solid var(--border);
    padding: var(--space-md) var(--space-xl);
    border-radius: var(--radius-md);
    font-weight: 500;
    font-size: 1rem;
    cursor: pointer;
    transition: var(--transition);
    text-decoration: none;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-sm);
    min-width: 160px;
  }

  .btn-cancel:hover {
    background: var(--background-subtle);
    border-color: var(--text-secondary);
  }

  .example-table {
    border: 1px solid var(--border);
    border-radius: var(--radius-md);
    overflow: hidden;
    margin-top: var(--space-lg);
  }

  .example-table table {
    width: 100%;
    border-collapse: collapse;
  }

  .example-table th {
    background: var(--background-subtle);
    padding: var(--space-sm) var(--space-md);
    text-align: left;
    font-weight: 600;
    color: var(--text);
    border-bottom: 1px solid var(--border);
    font-size: 0.875rem;
  }

  .example-table td {
    padding: var(--space-sm) var(--space-md);
    border-bottom: 1px solid var(--border-light);
    color: var(--text-secondary);
    font-family: var(--font-mono, monospace);
    font-size: 0.875rem;
  }

  .example-table tr:last-child td {
    border-bottom: none;
  }

  .file-selected {
    background: rgba(16, 185, 129, 0.1);
    border-color: #10b981;
    color: #10b981;
  }

  .selected-file-info {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    margin-top: var(--space-md);
    padding: var(--space-md);
    background: rgba(16, 185, 129, 0.1);
    border: 1px solid rgba(16, 185, 129, 0.3);
    border-radius: var(--radius-md);
    color: #10b981;
  }

  @media (max-width: 768px) {
    .import-container {
      padding: var(--space-lg);
    }

    .page-title {
      font-size: 1.75rem;
      flex-direction: column;
      gap: var(--space-sm);
    }

    .form-actions {
      flex-direction: column;
    }

    .file-input-label {
      padding: var(--space-lg);
      min-height: 150px;
    }

    .supported-formats {
      flex-wrap: wrap;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="import-page">
  <div class="page-header">
    <h1 class="page-title">
      <span class="page-icon">üìä</span>
      Importa√ß√£o de Dados
    </h1>
    <p class="page-subtitle">
      Importe dados de produtos a partir de planilhas Excel ou CSV
    </p>
  </div>

  <div class="instructions">
    <div class="instructions-title">
      <span>üí°</span>
      Como importar seus dados
    </div>
    <ul class="instructions-list">
      <li>
        <span class="step-number">1</span>
        <span
          >Prepare sua planilha com as colunas: <strong>codigo</strong>,
          <strong>nome</strong>, <strong>preco</strong>,
          <strong>descricao</strong></span
        >
      </li>
      <li>
        <span class="step-number">2</span>
        <span>Salve o arquivo nos formatos .xlsx ou .csv</span>
      </li>
      <li>
        <span class="step-number">3</span>
        <span>Selecione o arquivo abaixo e clique em "Importar"</span>
      </li>
      <li>
        <span class="step-number">4</span>
        <span>Aguarde o processamento e verifique os produtos importados</span>
      </li>
    </ul>
  </div>

  <div class="import-container">
    <form method="post" enctype="multipart/form-data" id="import-form">
      {% csrf_token %}

      <div class="import-section">
        <h3 class="section-title">
          <span class="section-icon">üìÅ</span>
          Selecionar Arquivo
        </h3>

        <div class="form-group">
          <label>Arquivo de Dados</label>
          <div class="file-input-wrapper">
            {{ form.arquivo }}
            <label
              for="{{ form.arquivo.id_for_label }}"
              class="file-input-label"
              id="file-label"
            >
              <div class="file-icon">üìÅ</div>
              <div class="file-text">Clique para selecionar arquivo</div>
              <div class="file-hint">ou arraste e solte aqui</div>
              <div class="supported-formats">
                <span class="format-badge">.xlsx</span>
                <span class="format-badge">.csv</span>
              </div>
            </label>
          </div>
          <div
            id="selected-file"
            class="selected-file-info"
            style="display: none"
          >
            <span>‚úÖ</span>
            <span id="file-name"></span>
          </div>
          {% if form.arquivo.errors %}
          <div class="form-error">{{ form.arquivo.errors }}</div>
          {% endif %}
        </div>
      </div>

      <div class="import-section">
        <h3 class="section-title">
          <span class="section-icon">üìã</span>
          Formato Esperado
        </h3>

        <p>Sua planilha deve conter as seguintes colunas na primeira linha:</p>

        <div class="example-table">
          <table>
            <thead>
              <tr>
                <th>codigo</th>
                <th>nome</th>
                <th>preco</th>
                <th>descricao</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>001</td>
                <td>Produto Exemplo</td>
                <td>29.90</td>
                <td>Descri√ß√£o do produto</td>
              </tr>
              <tr>
                <td>002</td>
                <td>Outro Produto</td>
                <td>45.50</td>
                <td>Outra descri√ß√£o</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn-import" id="import-btn" disabled>
          <span>üìä</span>
          Importar Dados
        </button>
        <a href="{% url 'relatorios:produto_list' %}" class="btn-cancel">
          <span>‚Üê</span>
          Voltar aos Produtos
        </a>
      </div>
    </form>
  </div>
</div>

<script>
  // Funcionalidade de drag and drop e preview do arquivo
  document.addEventListener("DOMContentLoaded", function () {
    const fileInput = document.getElementById(
      "{{ form.arquivo.id_for_label }}"
    );
    const fileLabel = document.getElementById("file-label");
    const selectedFileDiv = document.getElementById("selected-file");
    const fileNameSpan = document.getElementById("file-name");
    const importBtn = document.getElementById("import-btn");

    // Atualizar interface quando arquivo √© selecionado
    fileInput.addEventListener("change", function () {
      if (this.files && this.files[0]) {
        const file = this.files[0];
        fileLabel.classList.add("file-selected");
        fileLabel.innerHTML = `
                <div class="file-icon">‚úÖ</div>
                <div class="file-text">Arquivo selecionado</div>
                <div class="file-hint">Clique para alterar</div>
            `;

        selectedFileDiv.style.display = "flex";
        fileNameSpan.textContent = file.name;
        importBtn.disabled = false;
      } else {
        resetFileInterface();
      }
    });

    // Drag and drop
    fileLabel.addEventListener("dragover", function (e) {
      e.preventDefault();
      this.style.borderColor = "var(--primary)";
      this.style.background = "rgba(var(--primary-rgb), 0.1)";
    });

    fileLabel.addEventListener("dragleave", function (e) {
      e.preventDefault();
      this.style.borderColor = "var(--border)";
      this.style.background = "var(--background-subtle)";
    });

    fileLabel.addEventListener("drop", function (e) {
      e.preventDefault();
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        fileInput.files = files;
        fileInput.dispatchEvent(new Event("change"));
      }
      this.style.borderColor = "var(--border)";
      this.style.background = "var(--background-subtle)";
    });

    function resetFileInterface() {
      fileLabel.classList.remove("file-selected");
      fileLabel.innerHTML = `
            <div class="file-icon">üìÅ</div>
            <div class="file-text">Clique para selecionar arquivo</div>
            <div class="file-hint">ou arraste e solte aqui</div>
            <div class="supported-formats">
                <span class="format-badge">.xlsx</span>
                <span class="format-badge">.csv</span>
            </div>
        `;
      selectedFileDiv.style.display = "none";
      importBtn.disabled = true;
    }
  });
</script>
{% endblock %}
