{% extends 'base.html' %}
{% block title %}Gerenciar Itens - {{ template.nome }} - TabloideMP{% endblock %}
{% block content %}
<section>
  <div class="items-header">
    <h2>Gerenciar Itens: {{ template.nome }}</h2>
    <div class="header-info">
      <span class="template-dimensions">Grid: {{ template.colunas }}√ó{{ template.linhas }}</span>
      <span class="items-count">{{ itens|length }} itens adicionados</span>
    </div>
  </div>

  <div class="items-container">
    <div class="add-item-section">
      <h3>Adicionar Novo Item</h3>
      <form method="post" class="item-form">
        {% csrf_token %}
        
        <div class="form-row">
          <div class="form-group">
            <label for="{{ form.produto.id_for_label }}">Produto</label>
            {{ form.produto }}
            {% if form.produto.errors %}
              <div class="error">{{ form.produto.errors }}</div>
            {% endif %}
          </div>
          
          <div class="form-group">
            <label for="{{ form.ordem.id_for_label }}">Posi√ß√£o</label>
            {{ form.ordem }}
            {% if form.ordem.errors %}
              <div class="error">{{ form.ordem.errors }}</div>
            {% endif %}
            <small>Posi√ß√£o no grid (1 a {{ template.colunas }} √ó {{ template.linhas }})</small>
          </div>
        </div>
        
        <button type="submit" class="btn btn-primary">Adicionar Item</button>
      </form>
    </div>

    <div class="items-grid-section">
      <h3>Itens Posicionados</h3>
      
      {% if itens %}
        <div class="items-list">
          {% for item in itens %}
            <div class="item-card">
              <div class="item-info">
                <span class="item-position">Posi√ß√£o {{ item.ordem }}</span>
                <span class="item-product">{{ item.produto.nome }}</span>
                <span class="item-price">R$ {{ item.produto.preco|floatformat:2 }}</span>
              </div>
              <form method="post" action="{% url 'relatorios:template_item_remove' template_pk=template.pk item_pk=item.pk %}" class="remove-form">
                {% csrf_token %}
                <button type="submit" class="btn btn-remove" title="Remover item">Remover</button>
              </form>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="empty-grid">
          <p>Nenhum item adicionado ainda.</p>
          <p>Use o formul√°rio acima para adicionar produtos √†s posi√ß√µes do grid {{ template.colunas }}√ó{{ template.linhas }}.</p>
        </div>
      {% endif %}
    </div>
  </div>

  <div class="template-actions">
    <h3>A√ß√µes do Template</h3>
    <div class="action-buttons">
      <a href="{% url 'relatorios:template_update' template.pk %}" class="btn btn-secondary">
        ‚Üê Voltar para Edi√ß√£o
      </a>
      <a href="{% url 'relatorios:pdf_tabloide' %}?template={{ template.pk }}" class="btn btn-export" target="_blank">
        üìÑ Gerar PDF
      </a>
      <a href="{% url 'relatorios:jpeg_tabloide' %}?template={{ template.pk }}" class="btn btn-export" target="_blank">
        üñºÔ∏è Gerar JPEG
      </a>
    </div>
  </div>
</section>
{% endblock %}
