{% extends 'base.html' %}
{% block title %}Novo Template - TabloideMP{% endblock %}
{% block content %}
<section>
  <div style="display:flex;justify-content:space-between;align-items:center;">
    <h2>Novo Template</h2>
    <a href="{% url 'relatorios:template_list' %}" class="btn btn-secondary">← Voltar à Lista</a>
  </div>
  
  <div class="template-create-container">
    <div class="create-form-section">
      <h3>Configuração do Template</h3>
      <form method="post" enctype="multipart/form-data" class="template-create-form" id="template-form">
        {% csrf_token %}
        
        <div class="form-section">
          <h4>Informações Básicas</h4>
          
          <div class="form-row">
            <div class="form-group">
              <label for="{{ form.nome.id_for_label }}">Nome do Template</label>
              {{ form.nome }}
              {% if form.nome.errors %}
                <div class="error">{{ form.nome.errors }}</div>
              {% endif %}
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="{{ form.colunas.id_for_label }}">Colunas</label>
              {{ form.colunas }}
              {% if form.colunas.errors %}
                <div class="error">{{ form.colunas.errors }}</div>
              {% endif %}
              <small>Número de colunas (1-6)</small>
            </div>
            
            <div class="form-group">
              <label for="{{ form.linhas.id_for_label }}">Linhas</label>
              {{ form.linhas }}
              {% if form.linhas.errors %}
                <div class="error">{{ form.linhas.errors }}</div>
              {% endif %}
              <small>Número de linhas (1-8)</small>
            </div>
          </div>
          
          <div class="stats-info">
            <div class="stat-item">
              <span class="stat-label">Total de Posições:</span>
              <span class="stat-value" id="total-positions">3×4</span>
            </div>
          </div>
        </div>
        
        <div class="form-section">
          <h4>Aparência</h4>
          
          <div class="form-row">
            <div class="form-group">
              <label for="{{ form.cor_fundo_row.id_for_label }}">Cor Principal</label>
              <div class="color-input-group">
                <input type="color" name="{{ form.cor_fundo_row.name }}" value="{{ form.cor_fundo_row.value|default:'#FFFFFF' }}" id="{{ form.cor_fundo_row.id_for_label }}" class="color-picker">
                <span class="color-label">Cor de fundo das linhas principais</span>
              </div>
              {% if form.cor_fundo_row.errors %}
                <div class="error">{{ form.cor_fundo_row.errors }}</div>
              {% endif %}
            </div>
            
            <div class="form-group">
              <label for="{{ form.cor_fundo_alternada.id_for_label }}">Cor Alternada</label>
              <div class="color-input-group">
                <input type="color" name="{{ form.cor_fundo_alternada.name }}" value="{{ form.cor_fundo_alternada.value|default:'#FFFFFF' }}" id="{{ form.cor_fundo_alternada.id_for_label }}" class="color-picker">
                <span class="color-label">Cor de fundo alternada para intercalar</span>
              </div>
              {% if form.cor_fundo_alternada.errors %}
                <div class="error">{{ form.cor_fundo_alternada.errors }}</div>
              {% endif %}
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="{{ form.background_imagem.id_for_label }}">Imagem de Fundo</label>
              {{ form.background_imagem }}
              {% if form.background_imagem.errors %}
                <div class="error">{{ form.background_imagem.errors }}</div>
              {% endif %}
              <small>Imagem opcional para usar como fundo do template</small>
            </div>
          </div>
        </div>
        
        <div class="form-actions">
          <button type="submit" class="btn btn-primary">Criar Template</button>
          <a href="{% url 'relatorios:template_list' %}" class="btn btn-secondary">Cancelar</a>
        </div>
      </form>
    </div>
    
    <div class="preview-section">
      <h3>Pré-visualização</h3>
      <div class="template-preview" id="template-preview">
        <div class="preview-grid" id="preview-grid">
          <!-- Preview will be generated by JavaScript -->
        </div>
      </div>
      
      <div class="preview-info">
        <div class="info-item">
          <span class="info-label">Dimensões</span>
          <span class="info-value" id="preview-dimensions">3 × 4</span>
        </div>
        <div class="info-item">
          <span class="info-label">Total</span>
          <span class="info-value" id="preview-total">12 posições</span>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
// Template data for preview
let templateData = {
    colunas: 3,
    linhas: 4,
    items: []
};

// Ensure we have valid defaults
if (!templateData.colunas || templateData.colunas <= 0) templateData.colunas = 3;
if (!templateData.linhas || templateData.linhas <= 0) templateData.linhas = 4;
if (!templateData.items) templateData.items = [];

function updatePreview() {
    const colunas = parseInt(document.getElementById('{{ form.colunas.id_for_label }}').value) || 3;
    const linhas = parseInt(document.getElementById('{{ form.linhas.id_for_label }}').value) || 4;
    const corPrincipal = document.getElementById('{{ form.cor_fundo_row.id_for_label }}').value;
    const corAlternada = document.getElementById('{{ form.cor_fundo_alternada.id_for_label }}').value;
    
    // Update stats
    document.getElementById('total-positions').textContent = `${colunas}×${linhas}`;
    document.getElementById('preview-dimensions').textContent = `${colunas} × ${linhas}`;
    document.getElementById('preview-total').textContent = `${colunas * linhas} posições`;
    
    // Generate preview grid
    const grid = document.getElementById('preview-grid');
    grid.innerHTML = '';
    grid.style.gridTemplateColumns = `repeat(${colunas}, 1fr)`;
    
    for (let i = 0; i < linhas * colunas; i++) {
        const cell = document.createElement('div');
        cell.className = 'preview-cell';
        const row = Math.floor(i / colunas);
        cell.style.backgroundColor = row % 2 === 0 ? corPrincipal : corAlternada;
        cell.textContent = i + 1;
        grid.appendChild(cell);
    }
}

// Event listeners for real-time preview
document.getElementById('{{ form.colunas.id_for_label }}').addEventListener('input', updatePreview);
document.getElementById('{{ form.linhas.id_for_label }}').addEventListener('input', updatePreview);
document.getElementById('{{ form.cor_fundo_row.id_for_label }}').addEventListener('input', updatePreview);
document.getElementById('{{ form.cor_fundo_alternada.id_for_label }}').addEventListener('input', updatePreview);

// Initial preview
updatePreview();
</script>
{% endblock %}


